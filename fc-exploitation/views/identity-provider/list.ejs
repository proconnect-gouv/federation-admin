<!DOCTYPE html>
<html lang="fr">
<head>
  <% include partials/head.ejs %>
</head>
<body>
<% include partials/header.ejs %>
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <p class="h2">Gestion des fournisseurs d'identité</p>
      <form id="itemPerPage" data-init="itemPerPage" method="GET" action="<%= APP_ROOT %>/identity-provider">
        <p id="fi-count"><i><%= totalItems %> fournisseurs disponibles - Résultats par page :</i>
        <% include partials/choose-items-number-to-show.ejs %>
      </form>
      <% include partials/global-errors-handler.ejs %>
      <% if (CURRENT_USER.roles.includes('operator')) { %>
      <div class="d-inline-flex">
        <a class="btn btn-primary mb-3" href="<%= APP_ROOT %>/identity-provider/create">Créer un fournisseur d'identité</a>
      </div>
      <% } %>
      <%- include('partials/search', {userSearch}); %>
      <table class="table table-hover table-light shadow-sm" id="list-table">
        <thead class="thead-light">
        <tr>
          <th scope="col" class="col-3 border-bottom-0 border-top-0 border-right-0 border-secondary">
            <div class="align-text-th">Nom du FI (mire)</div>
            <%- include('partials/sort-table', { uri: "/identity-provider", sortOn: "name" }); %>
          </th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">Nom techique</th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">Email de contact</th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">
            <div class="align-text-th">Activé</div>
            <%- include('partials/sort-table', { uri: "/identity-provider", sortOn: "active" }); %>
          </th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">Affiché</th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">Eidas</th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">
            <div class="align-text-th">Ordre d'affichage</div>
            <%- include('partials/sort-table', { uri: "/identity-provider", sortOn: "order" }); %>
          </th>
          <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">Actions</th>
        </tr>
        </thead>
        <tbody>
        <% identityProviders.forEach(function(identityProvider){ %>
          <tr>
            <th scope="row" class="border-bottom-0 border-top-0 border-right-0 border-secondary">
              <% if (CURRENT_USER.roles.includes('operator')) { %>
                <a id='provider-<%= identityProvider._id %>' class="text-dark" href="<%= APP_ROOT %>/identity-provider/<%= identityProvider._id %>"><%= identityProvider.title %></a>
              <% } else { %>
                <%= identityProvider.title %>
              <% } %>
            </th>
            <td class="border border-bottom-0 border-top-0 border-right-0 border-secondary">
              <% if (CURRENT_USER.roles.includes('operator')) { %>
                <a id='technic-<%= identityProvider._id %>' class="text-dark" href="<%= APP_ROOT %>/identity-provider/<%= identityProvider._id %>"><%= identityProvider.name %></a>
              <% } else { %>
                <%= identityProvider.name %>
              <% } %>
            </td>
            <td class="border border-bottom-0 border-top-0 border-right-0 border-secondary"><%= identityProvider.mailto %></td>
            <td class="text-center border border-bottom-0 border-top-0 border-right-0 border-secondary">
              <i class="fa fa-toggle-<%= identityProvider.active ? "on" : "off" %>"></i>
            </td>
            <td class="text-center border border-bottom-0 border-top-0 border-right-0 border-secondary">
              <i class="fa fa-toggle-<%= identityProvider.display ? "on" : "off" %>"></i>
            </td>
            <td class="border border-bottom-0 border-top-0 border-right-0 border-secondary"><%= identityProvider.eidas %></td>
            <td class="border border-bottom-0 border-top-0 border-secondary"><%= identityProvider.order %></td>
            <td class=" d-flex">
              <% if (CURRENT_USER.roles.includes('operator')) { %>
                <a href="<%= APP_ROOT %>/identity-provider/<%= identityProvider._id %>"
                  class="d-flex align-items-center mr-2 btn-action-update">
                  <i class="fa fa-pencil-square-o text-dark" aria-hidden="true"
                  title="Editer le fournisseur d'identité"></i>
                </a>
                <form name="deleteForm" method="POST" id="delete-<%= identityProvider.name %>"
                  action="<%= APP_ROOT %>/identity-provider/<%= identityProvider.name %>?_method=DELETE"
                  class="d-flex align-items-center mr-2" data-init="removeItem" data-element-type="le fournisseur d'identité"
                  data-element-title="<%= identityProvider.title %>" data-element-id="<%= identityProvider.name %>"
                  novalidate>
                  <input type="hidden" name="_csrf" value="<%= locals.csrfToken%>">
                  <input type="hidden" name="_totp">
                  <input type="hidden" name="name" value="<%= identityProvider.name %>">
                  <button type="submit" class="btn-action-delete">
                    <i class="fa fa-trash" aria-hidden="true" title="Supprimer"></i>
                  </button>
                </form>
            <% } %>
          </td>
          </tr>
        <% }) %>
        </tbody>
      </table>
      <%- include('partials/pagination.ejs', {
        total: totalItems,
        baseHref: `${APP_ROOT}/identity-provider`,
      }) %>
    </div>
</body>
</html>
